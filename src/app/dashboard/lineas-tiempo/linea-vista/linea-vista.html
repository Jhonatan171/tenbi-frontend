<div class="vista-wrapper">
    <header class="header-top">
        <!-- Botón regresar -->
        <button class="btn-regresar" (click)="regresar()">
            <span class="icon-arrow">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M15 6L9 12L15 18" stroke="white" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </span>
            <span class="body__medium">Regresar</span>
        </button>

        <!-- Acciones -->
        <div class="barra-acciones">

            <!-- Presentar (Primary filled rounded with icon + subtle drop) -->
            <button class="btn btn-presentar" (click)="presentar()">
                <span class="icon">
                    <!-- Ícono de presentación estilo Canva -->
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <!-- Pantalla -->
                        <rect x="3" y="4" width="18" height="12" rx="2.2" stroke="currentColor" stroke-width="1.8" />

                        <!-- Botón play dentro de la presentación -->
                        <path d="M10 9.2L14.5 12L10 14.8V9.2Z" fill="currentColor" />

                        <!-- Patitas del soporte -->
                        <path d="M8 20h8" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                    </svg>
                </span>
                <span class="body__medium">Presentar</span>
            </button>


            <!-- Editar (outline) -->
            <button class="btn btn-outline" (click)="editarLinea()">
                <span class="icon">
                    <!-- ícono lápiz -->
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                        aria-hidden="true">
                        <path d="M3 21l3-1 11-11 1-3-3 1-11 11-1 3z" stroke="currentColor" stroke-width="1.6"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M14 7l3 3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </span>
                <span class="body__medium">Editar</span>
            </button>

            <!-- Cambiar plantilla (pill with light-bg + icon) -->
            <button class="btn btn-pill" (click)="cambiarPlantilla()">
                <span class="icon">
                    <!-- ícono grid -->
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                        aria-hidden="true">
                        <rect x="3.5" y="3.5" width="6" height="6" rx="1.2" stroke="currentColor" stroke-width="1.6" />
                        <rect x="14.5" y="3.5" width="6" height="6" rx="1.2" stroke="currentColor" stroke-width="1.6" />
                        <rect x="3.5" y="14.5" width="6" height="6" rx="1.2" stroke="currentColor" stroke-width="1.6" />
                        <rect x="14.5" y="14.5" width="6" height="6" rx="1.2" stroke="currentColor"
                            stroke-width="1.6" />
                    </svg>
                </span>
                <span class="body__medium">Cambiar plantilla</span>
            </button>

            <!-- Botón menú con tres puntos -->
            <div class="menu-container">
                <button class="btn btn-dots" (click)="toggleMenu()" aria-haspopup="true"
                    aria-expanded="{{menuAbierto}}">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="5" r="1.5" fill="currentColor" />
                        <circle cx="12" cy="12" r="1.5" fill="currentColor" />
                        <circle cx="12" cy="19" r="1.5" fill="currentColor" />
                    </svg>
                </button>


                <div class="menu" *ngIf="menuAbierto" role="menu" (clickOutside)="menuAbierto=false">
                    <!-- Compartir (blue pill) -->
                    <button class="menu-item menu-item-pill" (click)="mostrarCompartir = true; menuAbierto = false">

                        <span class="mi-icon">
                            <!-- icon share -->
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M4 12v6a2 2 0 0 0 2 2h12" stroke="currentColor" stroke-width="1.6"
                                    stroke-linecap="round" stroke-linejoin="round" />
                                <path d="M16 6l4 4-4 4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M20 10h-8" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </span>
                        <span class="body__medium">Compartir línea</span>
                    </button>

                    <!-- Exportar (neutral) -->
                    <button class="menu-item menu-item-neutral" (click)="exportar()" role="menuitem">
                        <span class="mi-icon">
                            <!-- icon export -->
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor"
                                    stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                                <path d="M7 10l5-5 5 5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M12 5v12" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </span>
                        <span class="body__medium">Exportar como</span>
                    </button>

                    <hr />

                    <!-- Eliminar (red pill) -->
                    <button class="menu-item menu-item-danger" (click)="mostrarEliminar = true; menuAbierto = false">
                        <span class="mi-icon">
                            <!-- Trash icon moderno -->
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                <!-- Tapa del tacho -->
                                <path d="M9.5 4h5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                                <path d="M4 7h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />

                                <!-- Cuerpo -->
                                <rect x="6" y="7" width="12" height="13" rx="2.2" stroke="currentColor"
                                    stroke-width="1.8" />

                                <!-- Líneas internas -->
                                <path d="M10 11v6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                                <path d="M14 11v6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                            </svg>
                        </span>

                        <span class="body__mediumstrong">Eliminar línea</span>
                    </button>

                </div>
            </div>
        </div>
    </header>

    <!-- CONTENEDOR BLANCO DONDE VA LA PLANTILLA -->
    <div class="contenedor-blanco" #contenedorPlantilla>
        <app-render-plantilla [lineaId]="lineaId" [linea]="lineaAEditar"> </app-render-plantilla>
    </div>
</div>
<!-- OVERLAY PARA PRESENTACIÓN -->
<div class="presentacion-overlay" *ngIf="presentando" (click)="cerrarPresentacion()">
    <div class="presentacion-contenido" (click)="$event.stopPropagation()">
        <app-render-plantilla [lineaId]="lineaId" [linea]="lineaAEditar"></app-render-plantilla>

        <!-- Botón salir flotante -->
        <button class="btn-salir" (click)="cerrarPresentacion()">
            ×
        </button>
    </div>

</div>
<!-- ======= MODAL PLANTILLA ======= -->
<div class="modal-overlay" *ngIf="mostrarModalPlantilla">
    <div class="modal-container">

        <app-seleccionar-plantilla [modo]="modoPlantilla" [lineaId]="idLineaAEditar" (cerrarPlantilla)="cerrarModal()"
            (volverFormulario)="cerrarModal()"></app-seleccionar-plantilla>

    </div>
</div>
<!-- ========= MODAL EXPORTAR COMO ========= -->
<div class="modal-overlay" *ngIf="exportModal">
    <div class="export-modal">

        <!-- Encabezado -->
        <div class="export-header">
            <button class="back-btn" (click)="cerrarExportModal()">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path d="M15 6L9 12L15 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>
            <span class="body__largestrong">Exportar como</span>
        </div>

        <hr />

        <!-- Opciones -->
        <div class="export-options">

            <button class="opcion" [class.active]="exportFormat==='pdf'" (click)="seleccionarFormato('pdf')">
                <!-- ICONO PDF -->
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <!-- Hoja -->
                    <path d="M6 2h8l6 6v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" stroke="currentColor"
                        stroke-width="1.6" stroke-linejoin="round" />
                    <!-- Doble de la hoja -->
                    <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                        stroke-linejoin="round" />
                    <!-- Texto PDF estilizado -->
                    <text x="6" y="17" font-size="6.5" font-family="sans-serif" fill="currentColor">
                        PDF
                    </text>
                </svg>
                <span class="body__medium">PDF</span>
            </button>

            <button class="opcion" [class.active]="exportFormat==='png'" (click)="seleccionarFormato('png')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <!-- Contorno -->
                    <rect x="3" y="4" width="18" height="14" rx="2.2" stroke="currentColor" stroke-width="1.6" />
                    <!-- Montaña -->
                    <path d="M7 15l3.5-4.5 2.5 3 3-4 3 5.5H7z" stroke="currentColor" stroke-width="1.4"
                        stroke-linecap="round" stroke-linejoin="round" />
                    <!-- Sol -->
                    <circle cx="15" cy="9" r="2" fill="currentColor" />
                </svg>

                <span class="body__medium">PNG</span>
            </button>

            <button class="opcion" [class.active]="exportFormat==='jpg'" (click)="seleccionarFormato('jpg')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <!-- Cuerpo de cámara -->
                    <rect x="3" y="6" width="18" height="14" rx="2.3" stroke="currentColor" stroke-width="1.6" />
                    <!-- Lente -->
                    <circle cx="12" cy="13" r="4" stroke="currentColor" stroke-width="1.5" />
                    <!-- Flash -->
                    <rect x="16" y="8" width="3" height="2" rx="0.4" fill="currentColor" />
                </svg>
                <span class="body__medium">JPG</span>
            </button>

        </div>

        <!-- Botón descargar -->
        <button class="btn-descargar" [class.disabled]="!exportFormat || descargando" (click)="descargar()">

            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M12 3v12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                <path d="M7 12l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                <rect x="4" y="17" width="16" height="4" rx="1.6" stroke="currentColor" stroke-width="2" />
            </svg>

            <span class="body__mediumstrong">{{ descargando ? 'Descargando...' : 'Descargar' }}</span>
        </button>

    </div>
</div>

<app-compartir-linea 
  *ngIf="mostrarCompartir"
  [lineaId]="lineaId"
  (cerrado)="mostrarCompartir=false">
</app-compartir-linea>
<app-modal-eliminar-linea
    [visible]="mostrarEliminar"
    [titulo]="'Mover línea a eliminados'"
    (onCerrar)="mostrarEliminar = false"
    (onConfirmar)="eliminarLinea()">
</app-modal-eliminar-linea>


<!-- ======= TOAST GLOBAL (fuera de cualquier overlay) ======= -->
<!-- TOAST GLOBAL -->
<div class="toast" *ngIf="toastVisible">
    <span class="check-icon">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M5 13l4 4L19 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
    </span>
    {{ toastMessage }}
</div>
<div #contenedorClon style="position: absolute; left: -9999px; top: 0; width: auto;"></div>
<app-modal-crear-linea-tiempo
  *ngIf="mostrarModalCrear"
  [lineaEditar]="lineaAEditar"
  (cerrarModal)="cerrarModalCrear($event)"
  (lineaActualizada)="onLineaActualizada($event)"
  (guardarEdicion)="actualizarVista($event)">
</app-modal-crear-linea-tiempo>
