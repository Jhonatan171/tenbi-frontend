<div class="center-screen-wrapper">
    <div class="header-tenbi">
    <svg id="logo_svg" aria-hidden="true" focusable="false" width="158" height="44" viewBox="0 0 158 44" fill="none"
      xmlns="http://www.w3.org/2000/svg">
      <path
        d="M6.01953 41.2385C5.0521 41.131 1.71984 40.4861 1.71985 36.1864C1.71985 31.8867 5.0521 31.3492 6.23451 31.1343C7.41692 30.9193 10.9642 31.0571 16.3388 30.9193C21.7134 30.7815 22.7883 25.1147 24.0782 22.4274C25.3681 19.7401 29.0228 19.7401 30.7427 20.0626C33.3091 20.5438 34.7199 23.0724 34.8274 25.5447C34.9349 28.017 34.0694 31.6126 31.9251 34.6815C29.2509 38.5086 25.4756 41.0235 21.9283 41.2385C18.3811 41.4535 6.98696 41.346 6.01953 41.2385Z"
        fill="#5585B5" />
      <path
        d="M10.3191 14.6879C10.3191 14.6879 9.35171 21.7824 9.5667 23.9323C9.78168 26.0821 10.5348 27.5458 11.609 27.9095C12.603 28.2462 14.0813 28.1962 14.6188 28.017C15.1563 27.8377 16.2877 27.8784 18.0586 25.2222C19.3485 23.2873 19.241 18.1277 22.8957 16.8378C26.5504 15.5479 29.4527 16.4078 31.71 15.9779C33.9674 15.5479 36.5337 14.5103 37.6221 11.7857C38.3384 9.99244 38.267 8.45341 37.9446 7.16351C37.6221 5.8736 36.1071 2.43391 31.3775 1.89647C26.6478 1.35903 23.0032 2.21889 23.0032 2.21889C17.7361 3.4013 11.9315 7.271 10.3191 14.6879Z"
        fill="#FF956C" />
      <path
        d="M60.6949 16.1961H67.9186V21.1492H60.6949V28.3728C60.6949 29.5008 61.0115 30.3815 61.6442 31.0144C62.2771 31.6473 63.1306 31.9646 64.2037 31.9646C64.8091 31.9646 65.4562 31.8817 66.1442 31.7166C66.832 31.5515 67.4233 31.3035 67.9186 30.9734V36.2156C67.3958 36.5183 66.7351 36.7526 65.9371 36.9177C65.1669 37.1103 64.4103 37.2058 63.6676 37.2058C61.714 37.2058 60.0763 36.8489 58.7555 36.1336C57.4622 35.3906 56.4853 34.3721 55.8248 33.0789C55.1644 31.758 54.8336 30.244 54.8336 28.5379V21.1492H51.0778V16.1961H54.8336V10.9959H60.6949V16.1961ZM128.174 17.5066C128.605 17.1728 129.072 16.8728 129.578 16.6091C130.843 15.9489 132.219 15.619 133.705 15.6189C135.824 15.6189 137.682 16.0721 139.278 16.9802C140.901 17.8883 142.167 19.1682 143.075 20.8191C143.983 22.4427 144.437 24.3145 144.437 26.4334C144.437 28.387 143.956 30.1896 142.993 31.8406C142.03 33.4641 140.708 34.7709 139.03 35.7615C137.379 36.7246 135.494 37.2058 133.375 37.2058C131.256 37.2058 129.357 36.7381 127.678 35.8025C126.028 34.867 124.72 33.5879 123.757 31.9646C122.794 30.3411 122.313 28.4971 122.313 26.4334V6.78493H128.174V17.5066ZM81.5016 15.4529C83.6754 15.4529 85.5194 15.9352 87.0328 16.8982C88.5463 17.8338 89.7026 19.0856 90.5006 20.6541C91.3261 22.2226 91.7389 23.943 91.7389 25.8142V27.5476H76.5397C76.6306 28.137 76.7968 28.6881 77.0446 29.199C77.5123 30.1067 78.1588 30.8218 78.984 31.3445C79.8371 31.8398 80.8419 32.0877 81.9977 32.0877C83.0983 32.0876 84.0889 31.8263 84.9694 31.3035C85.8774 30.7807 86.5651 30.0515 87.0328 29.116L91.5328 31.3865C90.6523 33.2302 89.3861 34.6613 87.735 35.6795C86.1115 36.6701 84.2126 37.1648 82.0387 37.1648C79.9198 37.1648 78.0075 36.7106 76.3014 35.8025C74.6229 34.867 73.3016 33.588 72.3385 31.9646C71.3754 30.3135 70.8942 28.4003 70.8942 26.2263C70.8942 24.2729 71.3341 22.4844 72.2145 20.8611C73.1226 19.21 74.3753 17.9024 75.9713 16.9392C77.5672 15.9488 79.4106 15.453 81.5016 15.4529ZM106.68 15.6189C109.074 15.6189 111.056 16.1136 112.625 17.1043C114.22 18.0673 115.417 19.3608 116.215 20.9841C117.013 22.6077 117.413 24.4246 117.413 26.4334V36.6287H111.551V27.1345C111.551 26.0889 111.372 25.1254 111.014 24.2449C110.657 23.3646 110.12 22.6631 109.405 22.1404C108.717 21.59 107.809 21.3142 106.68 21.3142C105.58 21.3142 104.671 21.59 103.956 22.1404C103.24 22.6631 102.718 23.3646 102.387 24.2449C102.057 25.0979 101.892 26.0614 101.892 27.1345V36.6287H96.0309V26.4334C96.0309 24.4521 96.4167 22.6497 97.1871 21.0261C97.9852 19.3751 99.1684 18.0674 100.737 17.1043C102.305 16.1138 104.286 15.6189 106.68 15.6189ZM155.04 36.6287H149.178V16.1961H155.04V36.6287ZM133.375 21.1492C132.384 21.1492 131.49 21.3836 130.692 21.8513C129.922 22.3191 129.302 22.9662 128.835 23.7918C128.394 24.5897 128.174 25.4704 128.174 26.4334C128.174 27.3688 128.394 28.236 128.835 29.034C129.302 29.8318 129.922 30.4782 130.692 30.9734C131.49 31.4411 132.384 31.6755 133.375 31.6756C134.393 31.6756 135.288 31.4412 136.058 30.9734C136.856 30.4782 137.475 29.8318 137.916 29.034C138.356 28.236 138.576 27.3688 138.576 26.4334C138.576 25.4704 138.356 24.5897 137.916 23.7918C137.475 22.9663 136.856 22.3191 136.058 21.8513C135.288 21.3835 134.393 21.1492 133.375 21.1492ZM81.4606 20.572C80.6077 20.5721 79.8513 20.7371 79.191 21.0672C78.5581 21.3974 78.0345 21.8516 77.6217 22.4295C77.2366 22.9797 76.9616 23.5991 76.7965 24.2869H85.9186C85.836 23.5714 85.5882 22.9378 85.1754 22.3875C84.7902 21.8098 84.2808 21.3698 83.6481 21.0672C83.0152 20.737 82.286 20.572 81.4606 20.572ZM152.109 5.87672C152.769 5.87675 153.375 6.04263 153.925 6.37282C154.476 6.70299 154.902 7.14297 155.205 7.69313C155.535 8.24349 155.7 8.8491 155.7 9.50954C155.7 10.1699 155.535 10.7891 155.205 11.367C154.902 11.9173 154.476 12.358 153.925 12.6882C153.375 12.9909 152.769 13.1413 152.109 13.1414C151.449 13.1414 150.829 12.9908 150.252 12.6882C149.701 12.358 149.261 11.9173 148.93 11.367C148.628 10.7891 148.476 10.1699 148.476 9.50954C148.476 8.8491 148.628 8.24349 148.93 7.69313C149.261 7.14279 149.701 6.70303 150.252 6.37282C150.829 6.0426 151.449 5.87672 152.109 5.87672Z"
        fill="black" fill-opacity="0.8" />
    </svg>
  </div>
  <div class="auth-box">
    
    <h2 class="title">Restablecer Contraseña</h2>

    <!--  Mensaje de error si el token no se encuentra en la URL al cargar -->
    <div *ngIf="errorMessage && !token" class="alert alert-danger mb-4">{{ errorMessage }}</div>
    
    <!--  Mensaje de éxito después de un restablecimiento exitoso -->
    <div *ngIf="resetSuccessful" class="alert alert-success mb-4">
      <p>✅ {{ message }}</p>
      <p>Serás redirigido al inicio de sesión en un momento...</p>
    </div>
    
    <!--  Formulario solo se muestra si tenemos un token y el restablecimiento no ha sido exitoso -->
    <form 
      *ngIf="token && !resetSuccessful" 
      [formGroup]="resetPasswordForm" 
      (ngSubmit)="onSubmit()" 
      class="form-container"
    >
      <p class="instruction-text">Introduce y confirma tu nueva contraseña segura.</p>


      <div class="form-group">
        <label for="newPassword">Nueva Contraseña:</label>
        <input 
          id="newPassword" 
          type="password" 
          formControlName="newPassword" 
          placeholder="Mín. 8 caracteres, Mayús, Minús, Número, Especial"
          class="input-field"
        >
        <div 
          *ngIf="resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched" 
          class="error-message"
        >
          La contraseña es obligatoria y debe cumplir los requisitos de seguridad.
        </div>
        <!-- Bloque de indicadores de validación de contraseña  -->

    <div 
      *ngIf="resetPasswordForm.get('newPassword')?.touched || resetPasswordForm.get('newPassword')?.errors"
      class="password-strength-indicators"
    >
      <!-- Obtener los errores del control de formulario -->
      <ng-container *ngIf="resetPasswordForm.get('newPassword')?.errors as errors">
        
        <p [class.valid]="!errors['minlength']" [class.invalid]="errors['minlength']">
          <span class="icon"></span> Mínimo 8 caracteres
        </p>
        <p [class.valid]="!errors['hasUpper']" [class.invalid]="errors['hasUpper']">
          <span class="icon"></span> Al menos una mayúscula
        </p>
        <p [class.valid]="!errors['hasLower']" [class.invalid]="errors['hasLower']">
          <span class="icon"></span> Al menos una minúscula
        </p>
        <p [class.valid]="!errors['hasNumber']" [class.invalid]="errors['hasNumber']">
          <span class="icon"></span> Al menos un número
        </p>
        <p [class.valid]="!errors['hasSpecial']" [class.invalid]="errors['hasSpecial']">
          <span class="icon"></span> Al menos un caracter especial (!@#$%^&*)
        </p>
      </ng-container>
    </div>
    
    <!-- Mensaje de error general si no cumple algún requisito  -->
    <div
      *ngIf="resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched"
      class="error-message mt-2"
    >
      La contraseña es obligatoria y debe cumplir todos los requisitos de seguridad.
    </div>
  </div>      


      <div class="form-group">
        <label for="confirmPassword">Confirmar Contraseña:</label>
        <input 
          id="confirmPassword" 
          type="password" 
          formControlName="confirmPassword" 
          placeholder="Repite la nueva contraseña"
          class="input-field"
        >
        <!-- Mostrar error si no coinciden -->
        <div 
          *ngIf="resetPasswordForm.errors?.['mismatch'] && resetPasswordForm.get('confirmPassword')?.touched" 
          class="error-message"
        >
          ⚠️ Las contraseñas no coinciden.
        </div>
      </div>

      <div *ngIf="errorMessage && !resetSuccessful" class="alert alert-danger">{{ errorMessage }}</div>

      <button 
        type="submit" 
        [disabled]="resetPasswordForm.invalid || isLoading" 
        class="btn btn-primary"
      >
        <span *ngIf="isLoading" class="spinner">Restableciendo...</span>
        <span *ngIf="!isLoading">Actualizar Contraseña</span>
      </button>
    </form>

    <p class="mt-3">
      <a routerLink="/inicio-sesion">Volver al inicio de sesión</a>
    </p>
  </div>
</div>
